{
	"name": "DSOPEstate_DF",
	"properties": {
		"description": "sums four columns from Estate sheet for each TM model",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DelimitedText1",
						"type": "DatasetReference"
					},
					"name": "ForestModel"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "ForestModelColumns"
				},
				{
					"name": "ColumnSums"
				},
				{
					"name": "AddStatus"
				},
				{
					"name": "NumericValues"
				},
				{
					"name": "Unpivot1"
				}
			],
			"script": "source(output(\n\t\tVersion as string,\n\t\tFund as string,\n\t\tAsset as string,\n\t\tPeriod as string,\n\t\tPlunitID as string,\n\t\tPlunit as string,\n\t\tOriginID as string,\n\t\tOrigin as string,\n\t\tSpeciesID as string,\n\t\tSpecies as string,\n\t\tPerpetualArea as string,\n\t\tCurrentArea as string,\n\t\tFutureArea as string,\n\t\tDisposed as string,\n\t\tAcquired as string,\n\t\tPerpetualFinalFell as string,\n\t\tCurrentFinalFell as string,\n\t\tFutureFinalFell as string,\n\t\tPerpetualLand as string,\n\t\tCurrentLand as string,\n\t\tFutureLand as string,\n\t\tPerpetualRental as string,\n\t\tCurrentRental as string,\n\t\tFutureRental as string,\n\t\tPerpetualOverhead as string,\n\t\tCurrentOverhead as string,\n\t\tFutureOverhead as string,\n\t\tPerpetualRates as string,\n\t\tCurrentRates as string,\n\t\tFutureRates as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false) ~> ForestModel\nForestModel select(mapColumn(\n\t\tVersion,\n\t\tFund,\n\t\tAsset,\n\t\tPeriod,\n\t\tPerpetualArea,\n\t\tPerpetualFinalFell,\n\t\tPerpetualLand,\n\t\tPerpetualRental,\n\t\tPerpetualOverhead,\n\t\tPerpetualRates\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ForestModelColumns\nNumericValues aggregate(groupBy(Version,\n\t\tFund,\n\t\tAsset,\n\t\tPeriod),\n\tPerpetualArea = sum(PerpetualArea),\n\t\tPerpetualFinalFell = sum(PerpetualFinalFell),\n\t\tPerpetualLand = sum(PerpetualLand),\n\t\tPerpetualRental = sum(PerpetualRental),\n\t\tPerpetualOverhead = sum(PerpetualOverhead),\n\t\tPerpetualRates = sum(PerpetualRates)) ~> ColumnSums\nColumnSums derive(Status = 'Estate_Calcs') ~> AddStatus\nForestModelColumns derive(PerpetualArea = toDecimal(PerpetualArea),\n\t\tPerpetualFinalFell = toDecimal(PerpetualFinalFell),\n\t\tPerpetualLand = toDecimal(PerpetualLand),\n\t\tPerpetualRental = toDecimal(PerpetualRental),\n\t\tPerpetualOverhead = toDecimal(PerpetualOverhead),\n\t\tPerpetualRates = toDecimal(PerpetualRates)) ~> NumericValues\nAddStatus unpivot(output(\n\t\tPerpetual as decimal(10,0),\n\t\tPerpetualArea as decimal(15,2),\n\t\tPerpetualFinalFell as decimal(NaN,0),\n\t\tPerpetualLand as decimal(15,2),\n\t\tPerpetualRental as decimal(NaN,0),\n\t\tPerpetualOverhead as decimal(NaN,0),\n\t\tPerpetualRates as decimal(NaN,0)\n\t),\n\tungroupBy(Version,\n\t\tFund,\n\t\tAsset,\n\t\tPeriod,\n\t\tStatus),\n\tlateral: true,\n\tignoreNullPivots: false) ~> Unpivot1"
		}
	}
}